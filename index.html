<!DOCTYPE html>
<html lang="zh-CN" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeYan Photography | GitHub è‡ªåŠ¨åŒæ­¥ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { zhihu: '#0084FF' } } }
        }
    </script>
    <style>
        .masonry { column-count: 2; column-gap: 12px; }
        @media (min-width: 768px) { .masonry { column-count: 3; } }
        @media (min-width: 1024px) { .masonry { column-count: 4; } }
        .m-item { break-inside: avoid; margin-bottom: 12px; cursor: pointer; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
        .dark .glass { background: rgba(15, 15, 15, 0.8); border-bottom: 1px solid #333; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* Viewer.js æ ·å¼å¾®è°ƒ */
        .viewer-download { color: #fff; font-family: FontAwesome; font-size: 18px; line-height: 40px; text-align: center; }
    </style>
</head>
<body class="bg-white dark:bg-zinc-950 transition-colors duration-500">

    <nav class="fixed top-0 w-full z-50 glass border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <img id="logo" src="heyanphotohei.png" alt="Logo" class="h-8">
            <div id="tag-bar" class="hidden md:flex space-x-2 overflow-x-auto no-scrollbar">
                <span class="text-gray-400 text-sm">æ­£åœ¨åŒæ­¥ä»“åº“æ•°æ®...</span>
            </div>
            <button onclick="toggleTheme()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-800">
                <span id="theme-icon">ğŸŒ™</span>
            </button>
        </div>
        <div id="tag-bar-mobile" class="md:hidden flex overflow-x-auto px-4 py-2 space-x-2 no-scrollbar border-t border-gray-50 dark:border-zinc-800"></div>
    </nav>

    <main class="pt-28 pb-12 px-4 max-w-7xl mx-auto">
        <div id="gallery" class="masonry"></div>
        <div id="loading" class="flex justify-center py-20">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-zhihu"></div>
        </div>
    </main>

    <script>
        // ======= é…ç½®åŒºåŸŸ =======
        const GITHUB_USER = 'heyan9'; // æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·å
        const GITHUB_REPO = 'photo'; // æ›¿æ¢ä¸ºä½ çš„ä»“åº“å
        const BASE_PATH = 'img1';        // ä½ çš„å›¾ç‰‡æ ¹ç›®å½•
        // =======================

        const galleryEl = document.getElementById('gallery');
        const tagBar = document.getElementById('tag-bar');
        const tagBarMobile = document.getElementById('tag-bar-mobile');
        let viewer = null;

        // 1. è·å– GitHub ç›®å½•ç»“æ„
        async function fetchRepoData() {
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${BASE_PATH}`);
                const data = await response.json();
                
                // è¿‡æ»¤å‡ºæ–‡ä»¶å¤¹
                const folders = data.filter(item => item.type === 'dir');
                renderTags(folders);
                
                if (folders.length > 0) {
                    loadFolderImages(folders[0].name); // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹
                }
                document.getElementById('loading').remove();
            } catch (err) {
                console.error("æ•°æ®æŠ“å–å¤±è´¥:", err);
                tagBar.innerHTML = `<span class="text-red-500 text-sm">API è°ƒç”¨è¶…é™æˆ–ä»“åº“é…ç½®é”™è¯¯</span>`;
            }
        }

        // 2. æ¸²æŸ“åˆ†ç±»æ ‡ç­¾
        function renderTags(folders) {
            tagBar.innerHTML = '';
            tagBarMobile.innerHTML = '';
            folders.forEach(folder => {
                const btn = document.createElement('button');
                btn.className = "px-4 py-1 rounded-full text-sm border border-zhihu text-zhihu hover:bg-zhihu hover:text-white transition whitespace-nowrap";
                btn.innerText = folder.name;
                btn.onclick = () => loadFolderImages(folder.name);
                
                tagBar.appendChild(btn.cloneNode(true));
                tagBarMobile.appendChild(btn);
            });
        }

        // 3. æŠ“å–å…·ä½“æ–‡ä»¶å¤¹å†…çš„å›¾ç‰‡
        async function loadFolderImages(folderName) {
            galleryEl.innerHTML = '<div class="col-span-full text-center py-10 text-gray-400">æ­£åœ¨åŠ è½½å›¾ç‰‡...</div>';
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${BASE_PATH}/${folderName}`);
                const files = await response.json();
                
                const images = files.filter(f => /\.(jpe?g|png|gif|webp)$/i.test(f.name));
                renderGallery(images);
            } catch (err) {
                galleryEl.innerHTML = 'åŠ è½½å¤±è´¥';
            }
        }

        // 4. æ¸²æŸ“ç€‘å¸ƒæµå¹¶ç»‘å®šæŸ¥çœ‹å™¨
        function renderGallery(images) {
            galleryEl.innerHTML = '';
            images.forEach(img => {
                const div = document.createElement('div');
                div.className = 'm-item group overflow-hidden rounded-xl bg-gray-100 dark:bg-zinc-900';
                // ä½¿ç”¨ jsDelivr CDN åŠ é€Ÿå›¾ç‰‡æ˜¾ç¤º
                const rawUrl = `https://cdn.jsdelivr.net/gh/${GITHUB_USER}/${GITHUB_REPO}/${img.path}`;
                
                div.innerHTML = `
                    <img src="${rawUrl}" data-original="${rawUrl}" class="w-full h-auto block transition duration-500 group-hover:scale-105" loading="lazy">
                `;
                galleryEl.appendChild(div);
            });

            // åˆå§‹åŒ–æˆ–æ›´æ–°å›¾ç‰‡æŸ¥çœ‹å™¨
            if (viewer) viewer.destroy();
            viewer = new Viewer(galleryEl, {
                url: 'data-original',
                toolbar: {
                    zoomIn: 4, zoomOut: 4, oneToOne: 4, reset: 4,
                    prev: 4, play: { show: 4, size: 'large' }, next: 4,
                    rotateLeft: 4, rotateRight: 4, flipHorizontal: 4, flipVertical: 4,
                    download: function() {
                        const a = document.createElement('a');
                        a.href = viewer.image.src;
                        a.download = viewer.image.alt;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    },
                },
            });
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            document.getElementById('logo').src = isDark ? 'heyanphotobai.png' : 'heyanphotohei.png';
            document.getElementById('theme-icon').innerText = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        fetchRepoData();
    </script>
</body>
</html>